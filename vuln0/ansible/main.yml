---
- name: "Provision vuln0"
  hosts: all
  become: true

  tasks:
  - name: Set hostname
    hostname:
      name: vuln0

  - name: Download MoinMoin
    get_url:
      url: https://www.exploit-db.com/apps/adfa15e3e37cf26b4b014f209959e9d9-moin-1.9.5.tar.gz
      dest: /opt/moin-1.9.5.tar.gz

  - name: Unpack MoinMoin source
    shell:
      cmd: cd /opt/ && gunzip moin-1.9.5.tar.gz

  - name: Unpack MoinMoin source
    shell:
      cmd: cd /opt/ && tar xvf moin-1.9.5.tar

  - name: Run MoinMoin setup
    shell:
      cmd: cd /opt/moin-1.9.5 && python setup.py install

  - name: Make MoinMoin listen on all interfaces
    replace:
      path: /opt/moin-1.9.5/wikiserverconfig.py
      regexp: 'localhost'
      replace: ""

  - name: Copy MoinMoin service
    copy:
        src: moinmoin.service
        dest: /etc/systemd/system/moinmoin.service

  - name: Start MoinMoin
    systemd:
      state: started
      name: moinmoin.service
      enabled: yes

  - name: Add MoinMoin CronJob
    cron:
      name: "Restart MoinMoin Service"
      job: "systemctl restart moinmoin.service"

  - name: Copy Path_Checker
    copy:
        src: path_checker.sh
        dest: /root/
        mode: '0755'

  - name: Change file ownership, group and permissions
    file:
      path: /usr/local/bin
      state: directory
      mode: '0777'

  - name: Add Path Checker CronJob
    cron:
      name: "Check Path Checker"
      job: "/root/path_checker.sh"      